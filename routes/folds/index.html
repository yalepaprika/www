<svelte:head>
  <title>Folds</title>
</svelte:head>

<Title title="Folds"/>
<FoldGrid layout={layout}/>

<style>
</style>

<script>
  import GridLayout from './_grid'
  import dateSort from '../_helpers/date-sort'

  export default {
    components: {
      FoldGrid: '../../components/FoldGrid.html',
      Title: '../../components/title.html'
    },
    async preload({ params, query }) {
      const maskFields = 'title/rendered,slug,meta'
      let res = await this.fetch(`folds.json?fields=${maskFields}`)
      if (!res.ok) {
        let message = await res.text()
        return this.error(res.status, message);
      }
      let folds = await res.json()
      folds.sort(dateSort)
      res = await this.fetch(`last-modified.json`)
      if (!res.ok) {
        message = await res.text()
        return this.error(res.status, message);
      }
      const data = await res.json()
      const grid = new GridLayout(data.lastModified)
      for (let fold of folds) {
        grid.addFold(fold)
      }
      return {
        layout: grid.layout()
      }
    },
    oncreate() {
      console.log(this.get())
    }
  };

  function getRandomInt(max) {
    return Math.floor(Math.random() * Math.floor(max));
  }
</script>