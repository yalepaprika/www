<svelte:head>
  <title>Paprika!</title>
</svelte:head>
  <div class="psf co1 mt2 c4 t0 l0 z1">
    <div class="w100 oh bgc-white">
      <img class="mx100 fold-front" src="{fold.meta.fold_front.media_details.sizes.full.source_url}">
    </div>
  </div>
<div class="x text">
  <Title title={fold.title.rendered}/>
</div>
<div class="x psr z2 text">
  <div class="co2 c4 posts">
    {#if fold.meta.posts}
      <h3>Articles</h3>
      <ArticleList articles={fold.meta.posts} />
    {/if}
  </div>
  <div class="c4">
    {@html fold.content.rendered}
  </div>
</div>

<style>
  .posts {
    margin-top: 15rem;
  }
  .fold-front {
    opacity: 0.6;
  }
</style>

<script>
  export default {
    components: {
      Title: '../components/Title.html',
      ArticleList: '../components/ArticleList.html'
    },
    async preload({ params, query }) {
      const maskFields = 'title/rendered,content/rendered,' +
        'meta(' +
          'volume,number,publication_date,fold_front,' +
          'fold_editors(title/rendered,slug),' +
          'graphic_designer(title/rendered,slug),' +
          'positions_editor(title/rendered,slug),' +
          'web_editor(title/rendered,slug),' +
          'posts(title/rendered,slug,meta/contributors(title/rendered))' +
        ')'
      const res = await this.fetch(`/index.json?fields=${maskFields}`)
      if (!res.ok) {
        const message = await res.text()
        return this.error(res.status, message);
      }
      const data = await res.json()
      return { fold: data }
    },
    oncreate() {
      console.log(this.get())
    }
  }
</script>