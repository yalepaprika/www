<svelte:head>
  <title>{decodeHTML(article.title.rendered)}</title>
</svelte:head>


<div class="x xafs">
  <div class="c2 p1">
    {#if article.meta}
      {#if article.meta.contributors}
        <ul>
          {#each article.meta.contributors as contributor}
            <li>
              <h2><a rel="prefetch" href="/contributors/{contributor.slug}">{@html contributor.title.rendered}</a></h2>
              <h3>{contributor.meta.degree}, {contributor.meta.graduation_year}</h3>
            </li>
          {/each}
        </ul>
      {/if}
      <h4>Paprika!</h4>
      {#if article.meta.fold}
        <p>vol. {article.meta.fold.meta.volume}, no. {article.meta.fold.meta.number}</p>
        <h5>{dateFormat(article.meta.fold.meta.publication_date)}</h5>
      {/if}
    {/if}
  </div>
  <div class="c6 p1 content">
    <h1 class="co2">{@html article.title.rendered}</h1>
    {@html article.content.rendered}
  </div>
</div>

<style>
  h1 {
    font-size: 4rem;
    line-height: 0.9;
    font-weight: 400;
    margin-bottom: 3rem;
  }

  :global(img) {
    display: block;
    margin-bottom: 1rem;
  }
</style>

<script>
  import dateFormat from '../_helpers/date-format.js'
  import decodeHTML from '../_helpers/decode-html.js'

  export default {
    helpers: {
      dateFormat,
      decodeHTML
    },
    async preload({ params, query }) {
      const maskFields = 'title/rendered,content/rendered,' +
        'meta(' +
          'contributors(title/rendered,slug,meta(degree,graduation_year)),' +
          'fold(meta(volume,number,publication_date))'
        ')'
      const res = await this.fetch(`articles/${params.slug}.json?fields=${maskFields}`);
      if (!res.ok) {
        const message = await res.text()
        return this.error(res.status, message);
      }
      const data = await res.json();
      return { article: data };
    },
    oncreate() {
      console.log(this.get())
    }
  };
</script>