<svelte:head>
  <title>Paprika!</title>
</svelte:head>
  <div class="psa co1 mt3 c10 sm-c4 t0 l0 z1">
    <div class="w100 oh bgc-paprika">
      <img class="mx100 fold-front" src="{fold.meta.fold_front.media_details.sizes.full.source_url}">
    </div>
  </div>
<div class="x">
  <Title title={fold.title.rendered}/>
</div>
<div class="x xw psr z2 text">
  <div class="c12 sm-co2 sm-c4 posts pr1">
    {#if fold.meta.posts}
      <h3>Articles</h3>
      <ArticleList articles={fold.meta.posts} />
    {/if}
  </div>
  <div class="c12 sm-c4">
    {@html fold.content.rendered}
  </div>
</div>

<style>
  .posts {
    margin-top: 7rem;
  }
  @media (min-width: 768px) {
    .posts {
      margin-top: 15rem;
    }
  }
  .fold-front {
    opacity: 0.8;
    mix-blend-mode: screen;
  }
</style>

<script>
  export default {
    components: {
      Title: '../../components/Title.html',
      ArticleList: '../../components/ArticleList.html'
    },
    async preload({ params, query }) {
      const maskFields = 'title/rendered,content/rendered,' +
        'meta(' +
          'volume,number,publication_date,' +
          'fold_front/media_details/sizes/full/source_url,' +
          'fold_editors(title/rendered,slug),' +
          'graphic_designer(title/rendered,slug),' +
          'positions_editor(title/rendered,slug),' +
          'web_editor(title/rendered,slug),' +
          'posts(title/rendered,slug,meta/contributors(title/rendered)),' +
        ')'
      const res = await this.fetch(`/index.json?fields=${maskFields}`)
      if (!res.ok) {
        const message = await res.text()
        return this.error(res.status, message);
      }
      const data = await res.json()
      return { fold: data }
    }
  }
</script>